# Data Schema Documentation - Drone Image Quality Analyzer

This document provides a comprehensive overview of all data types, structures, and metrics collected, processed, and generated by the Drone Image Quality Analyzer application.

## Table of Contents

1. [Input Data](#input-data)
2. [Extracted Metadata (EXIF)](#extracted-metadata-exif)
3. [Processed Image Data](#processed-image-data)
4. [Core Analysis Results](#core-analysis-results)
5. [Composite Scores & Recommendations](#composite-scores--recommendations)
6. [Application State & UI Data](#application-state--ui-data)
7. [Performance & Debug Data](#performance--debug-data)
8. [Export Data Formats](#export-data-formats)

---

## Input Data

### File Information
| Field | Type | Description | Source |
|-------|------|-------------|---------|
| `file` | `File` | Original browser File object | User upload |
| `name` | `string` | Original filename | `file.name` |
| `size` | `number` | File size in bytes | `file.size` |
| `type` | `string` | MIME type (e.g., 'image/jpeg') | `file.type` |

### File Validation
| Field | Type | Description | Range/Values |
|-------|------|-------------|--------------|
| `validTypes` | `string[]` | Supported file formats | `['image/jpeg', 'image/jpg', 'image/png', 'image/tiff', 'image/tif']` |
| `maxSize` | `number` | Maximum file size | 50MB (52,428,800 bytes) |
| `validationError` | `string?` | Error message if validation fails | Text description |

---

## Extracted Metadata (EXIF)

### Camera Information
| Field | Type | Description | EXIF Source |
|-------|------|-------------|-------------|
| `make` | `string?` | Camera manufacturer | `Make` |
| `model` | `string?` | Camera model | `Model` |
| `lens` | `string?` | Lens model/specification | `LensModel` or `LensSpecification` |

### Camera Settings
| Field | Type | Description | EXIF Source | Typical Range |
|-------|------|-------------|-------------|---------------|
| `iso` | `number?` | ISO sensitivity | `ISO` or `ISOSpeedRatings` | 100-6400 |
| `aperture` | `number?` | F-stop value | `FNumber` or `ApertureValue` | f/1.4 - f/22 |
| `shutterSpeed` | `string?` | Exposure time | `ExposureTime` | "1/1000s" - "30s" |
| `focalLength` | `number?` | Lens focal length (mm) | `FocalLength` | 14-600mm |
| `whiteBalance` | `string?` | White balance setting | `WhiteBalance` | "Auto", "Daylight", etc. |
| `meteringMode` | `string?` | Exposure metering mode | `MeteringMode` | "Matrix", "Spot", etc. |

### Location Data (GPS)
| Field | Type | Description | EXIF Source | Format |
|-------|------|-------------|-------------|---------|
| `latitude` | `number?` | GPS latitude | `latitude` | Decimal degrees |
| `longitude` | `number?` | GPS longitude | `longitude` | Decimal degrees |
| `altitude` | `number?` | GPS altitude | `GPSAltitude` | Meters |

### File Format Information
| Field | Type | Description | EXIF Source |
|-------|------|-------------|-------------|
| `format` | `string` | File format | Derived from MIME type |
| `compression` | `string?` | Compression method | `Compression` |
| `bitDepth` | `number?` | Bits per sample | `BitsPerSample` |
| `colorProfile` | `string?` | Color space | `ColorSpace` |
| `timestamp` | `Date?` | Image capture time | `DateTimeOriginal` or `DateTime` |

---

## Processed Image Data

### Canvas Processing
| Field | Type | Description | Processing |
|-------|------|-------------|------------|
| `canvas` | `HTMLCanvasElement` | Working canvas element | Created for analysis |
| `ctx` | `CanvasRenderingContext2D` | 2D rendering context | Canvas context |
| `imageData` | `ImageData` | Pixel data array | `ctx.getImageData()` |
| `width` | `number` | Processed image width | Limited to 800px max |
| `height` | `number` | Processed image height | Maintains aspect ratio |

### Thumbnail Generation
| Field | Type | Description | Processing |
|-------|------|-------------|------------|
| `thumbnail` | `string` | Base64 data URL | JPEG, 80% quality, 150px max |
| `thumbnailSize` | `number` | Thumbnail dimensions | Calculated from aspect ratio |

### Color Space Conversion
| Field | Type | Description | Algorithm |
|-------|------|-------------|-----------|
| `grayscale` | `Float32Array` | Luminance values | Y = 0.299R + 0.587G + 0.114B |
| `yCrCb.y` | `Float32Array` | Luminance channel | ITU-R BT.601 conversion |
| `yCrCb.cr` | `Float32Array` | Red chrominance | ITU-R BT.601 conversion |
| `yCrCb.cb` | `Float32Array` | Blue chrominance | ITU-R BT.601 conversion |

---

## Core Analysis Results

### Blur Analysis (Laplacian Variance)
| Field | Type | Description | Range | Algorithm |
|-------|------|-------------|-------|-----------|
| `blurScore` | `number` | Overall sharpness score | 0-100 | Laplacian variance with log normalization |
| `laplacianVariance` | `number` | Raw variance value | 0+ | Variance of Laplacian kernel response |
| `edgeResponse` | `number[]` | Per-pixel edge strength | 0-255 | Laplacian kernel convolution |

### Enhanced Exposure Analysis
| Field | Type | Description | Range | Algorithm |
|-------|------|-------------|-------|-----------|
| `exposureScore` | `number` | Overall exposure quality | 0-100 | Weighted composite of metrics below |
| `overexposurePercentage` | `number` | Blown highlights | 0-100% | Pixels > 250/255 |
| `underexposurePercentage` | `number` | Blocked shadows | 0-100% | Pixels < 5/255 |
| `dynamicRange` | `number` | Tonal range | 0-255 | P95 - P5 percentile values |
| `averageBrightness` | `number` | Mean luminance | 0-255 | Average of all pixel values |
| `contrastRatio` | `number` | Contrast measurement | 1+ | (Max + 0.05) / (Min + 0.05) |
| `histogramBalance` | `string` | Exposure classification | enum | "balanced", "overexposed", "underexposed", "high-contrast" |
| `localContrast` | `number` | Spatial contrast | 0-100 | 9x9 window variance analysis |
| `highlightRecovery` | `number` | Recoverable highlights | 0-100% | Highlights with detail retention |
| `shadowDetail` | `number` | Shadow detail retention | 0-100% | Shadows above black point |
| `colorBalance.y` | `number` | Luminance balance | 0-1 | Average Y channel value |
| `colorBalance.cr` | `number` | Red chrominance | 0-1 | Average Cr channel value |
| `colorBalance.cb` | `number` | Blue chrominance | 0-1 | Average Cb channel value |
| `perceptualExposureScore` | `number` | Perceptual quality | 0-100 | Human vision-weighted assessment |
| `spatialExposureVariance` | `number` | Regional consistency | 0+ | Variance across image regions |

### Noise Analysis
| Field | Type | Description | Range | Algorithm |
|-------|------|-------------|-------|-----------|
| `noiseScore` | `number` | Overall noise quality | 0-100 | Composite of metrics below |
| `noiseLevel` | `number` | Noise magnitude | 0-100 | Local standard deviation (8x8 blocks) |
| `snrRatio` | `number` | Signal-to-noise ratio | 0+ | Mean / Standard deviation |
| `compressionArtifacts` | `number` | JPEG blocking | 0-100 | 8x8 block boundary analysis |
| `chromaticAberration` | `number` | Color fringing | 0-100 | Color channel misalignment at edges |
| `vignetting` | `number` | Corner darkening | 0-100% | Center vs corner brightness ratio |
| `overallArtifactScore` | `number` | Combined artifacts | 0-100 | Average of artifact metrics |

### Feature Detection (Descriptor Analysis)
| Field | Type | Description | Range | Algorithm |
|-------|------|-------------|-------|-----------|
| `keypointCount` | `number` | Total detected features | 0+ | Harris + FAST + Edge + Blob detection |
| `keypointDensity` | `number` | Features per 1000 pixels | 0+ | keypointCount / (pixels / 1000) |
| `keypointDistribution.uniformity` | `number` | Spatial uniformity | 0-100% | Inverse coefficient of variation |
| `keypointDistribution.coverage` | `number` | Image coverage | 0-100% | Percentage of non-empty grid cells |
| `keypointDistribution.clustering` | `number` | Feature clustering | 0-100 | Nearest neighbor distance analysis |
| `featureStrength.average` | `number` | Mean feature strength | 0+ | Average keypoint response |
| `featureStrength.median` | `number` | Median feature strength | 0+ | Median keypoint response |
| `featureStrength.standardDeviation` | `number` | Strength consistency | 0+ | Standard deviation of responses |
| `descriptorQuality.distinctiveness` | `number` | Feature uniqueness | 0-100 | Local contrast analysis |
| `descriptorQuality.repeatability` | `number` | Detection consistency | 0-100 | Strength variance analysis |
| `descriptorQuality.matchability` | `number` | Matching potential | 0-100 | Predicted matching success |
| `photogrammetricScore` | `number` | 3D reconstruction suitability | 0-100 | Weighted feature quality score |
| `reconstructionSuitability` | `string` | Quality classification | enum | "excellent", "good", "acceptable", "poor", "unsuitable" |
| `featureTypes.corners` | `number` | Corner features | 0+ | Harris + FAST detection |
| `featureTypes.edges` | `number` | Edge features | 0+ | Sobel edge detection |
| `featureTypes.blobs` | `number` | Blob features | 0+ | LoG approximation |
| `featureTypes.textured` | `number` | Texture features | 0+ | High-frequency content |
| `scaleInvariance` | `number` | Scale robustness | 0-100% | Scale distribution analysis |
| `rotationInvariance` | `number` | Rotation robustness | 0-100% | Angle distribution analysis |

---

## Composite Scores & Recommendations

### Weighted Quality Scores
| Field | Type | Description | Weight | Range |
|-------|------|-------------|--------|-------|
| `blur` | `number` | Sharpness component | 30% | 0-100 |
| `exposure` | `number` | Exposure component | 25% | 0-100 |
| `noise` | `number` | Noise component | 20% | 0-100 |
| `technical` | `number` | Technical component | 10% | 0-100 |
| `descriptor` | `number` | Feature component | 15% | 0-100 |
| `overall` | `number` | Weighted composite | 100% | 0-100 |

### Quality Classification
| Field | Type | Description | Threshold |
|-------|------|-------------|-----------|
| `recommendation` | `string` | Quality level | Based on overall score |
| | | "excellent" | ≥ 85 |
| | | "good" | 70-84 |
| | | "acceptable" | 55-69 |
| | | "poor" | 40-54 |
| | | "unsuitable" | < 40 |

### Photogrammetric Assessment
| Field | Type | Description | Algorithm |
|-------|------|-------------|-----------|
| `photogrammetricSuitability` | `number` | 3D reconstruction score | Descriptor 40% + Blur 30% + Exposure 20% + Noise 10% |
| `reconstructionRecommendation` | `string` | Suitability classification | Based on photogrammetric score |

---

## Application State & UI Data

### Processing Progress
| Field | Type | Description | Updates |
|-------|------|-------------|---------|
| `current` | `number` | Images processed | Real-time |
| `total` | `number` | Total images | Set at start |
| `isProcessing` | `boolean` | Processing state | Real-time |
| `startTime` | `number` | Processing start timestamp | Set at start |
| `currentImageName` | `string?` | Current file being processed | Per image |
| `currentStep` | `number?` | Processing step (1-5) | Per step |
| `currentStepName` | `string?` | Step description | Per step |
| `currentImageProgress` | `number?` | Sub-progress within image | Per operation |

### Quality Statistics
| Field | Type | Description | Calculation |
|-------|------|-------------|-------------|
| `totalImages` | `number` | Total analyzed | Count of analyses |
| `excellentCount` | `number` | Excellent quality images | recommendation === 'excellent' |
| `goodCount` | `number` | Good quality images | recommendation === 'good' |
| `acceptableCount` | `number` | Acceptable quality images | recommendation === 'acceptable' |
| `poorCount` | `number` | Poor quality images | recommendation === 'poor' |
| `unsuitableCount` | `number` | Unsuitable images | recommendation === 'unsuitable' |
| `averageBlurScore` | `number` | Mean blur score | Sum / count |
| `averageCompositeScore` | `number` | Mean composite score | Sum / count |
| `averageDescriptorScore` | `number` | Mean descriptor score | Sum / count |
| `averageKeypointCount` | `number` | Mean keypoint count | Sum / count |
| `recommendedForReconstruction` | `number` | Images above threshold | Count where score ≥ threshold |

### User Interface State
| Field | Type | Description | Values |
|-------|------|-------------|--------|
| `threshold` | `number` | Quality threshold | 0-100 (default: 70) |
| `filter` | `string` | Display filter | "all", "recommended", "not-recommended" |
| `sortBy` | `string` | Sort criteria | "name", "score", "quality", "composite" |
| `selectedImage` | `ImageAnalysis?` | Currently selected image | Analysis object or null |

---

## Performance & Debug Data

### WebGL Performance Benchmarks
| Field | Type | Description | Units |
|-------|------|-------------|-------|
| `operation` | `string` | Operation name | "blur", "harris", etc. |
| `cpuTime` | `number` | CPU execution time | Milliseconds |
| `gpuTime` | `number` | GPU execution time | Milliseconds |
| `speedup` | `number` | Performance ratio | cpuTime / gpuTime |
| `imageSize` | `number` | Image pixel count | Pixels |
| `timestamp` | `number` | Benchmark timestamp | Unix timestamp |

### WebGL Capabilities
| Field | Type | Description | Detection |
|-------|------|-------------|-----------|
| `webgl` | `boolean` | WebGL support | Context creation test |
| `webgl2` | `boolean` | WebGL 2.0 support | Context creation test |
| `maxTextureSize` | `number` | Maximum texture size | GL parameter |
| `maxViewportDims` | `[number, number]` | Maximum viewport | GL parameter |
| `extensions` | `string[]` | Supported extensions | Extension enumeration |
| `supportsHighPrecision` | `boolean` | High precision floats | Precision format query |
| `supportsFloatTextures` | `boolean` | Float texture support | Extension check |

### Debug Visualization Data
| Field | Type | Description | Generation |
|-------|------|-------------|------------|
| `originalImage` | `string` | Original image data URL | File conversion |
| `laplacianVisualization` | `string?` | Edge detection visualization | WebGL shader output |
| `harrisVisualization` | `string?` | Corner detection visualization | WebGL shader output |
| `sobelVisualization` | `string?` | Sobel edge visualization | WebGL shader output |

---

## Export Data Formats

### CSV Export Fields
| Column | Type | Description | Source |
|--------|------|-------------|--------|
| Filename | `string` | Original filename | `analysis.name` |
| Composite Score | `number` | Overall quality score | `compositeScore.overall` |
| Blur Score | `number` | Sharpness score | `blurScore` |
| Exposure Score | `number` | Exposure quality | `exposureAnalysis.exposureScore` |
| Noise Score | `number` | Noise quality | `noiseAnalysis.noiseScore` |
| Technical Score | `number` | Technical quality | Calculated from metadata |
| Descriptor Score | `number` | Feature quality | `descriptorAnalysis.photogrammetricScore` |
| Keypoint Count | `number` | Detected features | `descriptorAnalysis.keypointCount` |
| Keypoint Density | `number` | Feature density | `descriptorAnalysis.keypointDensity` |
| Feature Distribution | `number` | Spatial uniformity | `descriptorAnalysis.keypointDistribution.uniformity` |
| Photogrammetric Suitability | `string` | 3D reconstruction suitability | `descriptorAnalysis.reconstructionSuitability` |
| Recommendation | `string` | Quality classification | `compositeScore.recommendation` |
| Recommended for Reconstruction | `string` | Above threshold flag | "Yes" / "No" |
| File Size (MB) | `number` | File size | `size / 1024 / 1024` |
| Camera Make | `string` | Camera manufacturer | `metadata.camera.make` |
| Camera Model | `string` | Camera model | `metadata.camera.model` |
| ISO | `number` | ISO setting | `metadata.settings.iso` |
| Aperture | `number` | F-stop value | `metadata.settings.aperture` |
| Shutter Speed | `string` | Exposure time | `metadata.settings.shutterSpeed` |
| Focal Length | `number` | Lens focal length | `metadata.settings.focalLength` |
| Status | `string` | Processing status | "Success" / "Error" |

### Text Report Format
| Section | Content | Description |
|---------|---------|-------------|
| Header | Title, timestamp, threshold | Report metadata |
| Summary Statistics | Counts, averages, percentages | Aggregate metrics |
| Quality Distribution | Breakdown by quality level | Classification counts |
| Detailed Results | Per-image analysis | Individual recommendations |
| Recommendations | Usage guidelines | Best practices |

---

## Data Flow Summary

```
Input Files
    ↓
File Validation & Metadata Extraction
    ↓
Image Processing (Canvas, Thumbnails)
    ↓
Core Analysis (Blur, Exposure, Noise, Features)
    ↓
Composite Scoring & Classification
    ↓
UI State Management & Display
    ↓
Export Generation (CSV, Reports)
```

## Data Persistence

| Data Type | Persistence | Duration | Storage |
|-----------|-------------|----------|---------|
| Input Files | Memory only | Session | Browser memory |
| Analysis Results | Memory only | Session | Browser memory |
| Thumbnails | Memory only | Session | Browser memory |
| Performance Benchmarks | Memory only | Session | Browser memory |
| User Settings (threshold, filters) | Memory only | Session | Browser memory |
| Export Data | File download | Permanent | User's file system |

## Data Security & Privacy

- **No Server Upload**: All processing occurs client-side
- **No Persistent Storage**: No data stored in localStorage or cookies
- **Memory Cleanup**: Automatic cleanup of image data and WebGL contexts
- **File Access**: Only user-selected files are accessed
- **Metadata Privacy**: EXIF data processed locally, not transmitted

---

*This document covers all data structures and metrics as of the latest application version. For implementation details, refer to the TypeScript interfaces in `src/types/index.ts`.*